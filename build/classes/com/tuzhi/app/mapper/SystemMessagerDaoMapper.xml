<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SystemMessagerDaoMapper">
	<resultMap type="com.tuzhi.app.entity.AppFeedback" id="resultFeedback"/>
	<resultMap type="com.tuzhi.app.entity.AppMessage" id="resultMessage"/>
	<resultMap type="com.tuzhi.app.entity.AppMsgReceive" id="resultMsgReceive"/>
	
	<!-- 添加反馈意见 -->
  	<insert id="insertFeedback" parameterType="map" >
		insert into app_feedback(
		  <if test="email != null and email != ''">
			email,
		  </if>
		  <if test="phone != null and phone != ''">
			phone,
		  </if>
		  <if test="opinion_content != null and opinion_content != ''">
			opinion_content,
		  </if>
		  <if test="type != null and type != ''">
			type,
		  </if>
		  <if test="user_id != null and user_id != ''">
			u_id,
		  </if>
		    time
		)values(
		  <if test="email != null and email != ''">
			#{email},
		  </if>
		  <if test="phone != null and phone != ''">
			#{phone},
		  </if>
		  <if test="opinion_content != null and opinion_content != ''">
			#{opinion_content},
		  </if>
		  <if test="type != null and type != ''">
			#{type},
		  </if>
		  <if test="user_id != null and user_id != ''">
			#{user_id},
		  </if>
		    getdate()
		)
  	</insert>
	
	<!-- 查询消息 -->
	<select id="getMessage" parameterType="map" resultMap="resultMessage">
		select m.* from app_message m
          left join app_msg_receive r on m.id=r.msg_id
          left join app_user_info u on  r.u_id=u.id
  		 where 1=1
  		 <if test="user_id !=null and user_id != ''">
			and r.u_id = #{user_id}
		 </if>
		 <if test="type !=null and type != ''">
			and r.type = #{type}
		 </if>
		 <if test="msg_id !=null and msg_id != ''">
			and m.id = #{msg_id}
		 </if>
		 <if test="token !=null and token != ''">
			and  u.token=#{token}
		 </if>
		order by m.sendtime desc
	</select>
	
  	
<!--   	<update id="update" parameterType="com.XingJia.pojo.User"> -->
<!-- 		update xj_user set -->
<!-- 		  <if test="deptId !=null and deptId !='' "> -->
<!--               deptId=#{deptId}, -->
<!--           </if>  -->
<!-- 		  <if test="modifyUser !=null and modifyUser !='' "> -->
<!--               modifyUser=#{modifyUser}, -->
<!--           </if> -->
<!-- 		  <if test="isStoreUser !=null"> -->
<!--               isstoreuser=#{isStoreUser}, -->
<!--           </if> -->
<!--             storeId=#{storeId}, -->
<!-- 			modifyDate=sysdate -->
			
<!-- 		where userId=#{userId}  -->
<!--   	</update> -->
  	
</mapper>